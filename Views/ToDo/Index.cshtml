@model ToDoList.ViewModels.ToDoViewModel

@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<section class="gradient-custom-2">
    <div class="container py-5">
        <div class="row d-flex justify-content-center align-items-center h-100">
            <div class="col-md-12 col-xl-10">
                <div class="card mask-custom">
                    <div class="card-body p-4 text-white">
                        <div class="text-center pt-3 pb-2">
                            <img src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-todo-list/check1.webp"
                                 alt="Check" width="60">
                            <h2 class="my-4">To Do List</h2>
                        </div>
                        <table class="table text-white mb-0">
                            <thead>
                                <tr>
                                    <th scope="col">Creator</th>
                                    <th scope="col">Task</th>
                                    <th scope="col">Priority</th>
                                    <th scope="col">Create Date</th>
                                    <th scope="col">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var todolist in Model.ToDoItems)
                                {
                                    <tr class="fw-normal @if(todolist.IsDone) { <text>gradient-complete text-white</text> }">
                                        <th class="border-0">
                                            <img src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-chat/ava6-bg.webp"
                                                    alt="avatar 1" style="width: 45px; height: auto;">
                                            <span class="ms-2">Admin</span>
                                        </th>
                                        <td class="border-0 align-middle fw-bold">
                                                @todolist.Title
                                        </td>
                                        <td class="border-0 align-middle">
                                            <h5 class="mb-0">
                                                <span class="badge @if(todolist.PriorityID==1) { <text>bg-success</text> }
                                                                   @if(todolist.PriorityID==2) { <text>bg-info</text> }
                                                                   @if(todolist.PriorityID==3) { <text>bg-warning</text> }
                                                                   @if(todolist.PriorityID==4) { <text>bg-danger</text> }">
                                                    @todolist.Priority.Name
                                                </span>
                                            </h5>
                                        </td>
                                        <td class="border-0 align-middle fw-bold">
                                                @todolist.CreateDate.ToShortDateString()
                                        </td>
                                        <td rowspan="2" class="border-0 align-middle">
                                            <div class="text-center mb-2">
                                                <form method="post" action="/ToDo/Complete/@todolist.ItemID">
                                                    <button type="submit" class="btn btn-bold btn-outline-success" data-mdb-toggle="tooltip" title="Complete">
                                                        <i class="fas fa-check fa-lg text-white me-3"></i>
                                                    </button>
                                                </form>
                                            </div>
                                            <div class="text-center mb-2">
                                                <button class="btn btn-bold btn-outline-primary" data-mdb-toggle="tooltip" data-bs-toggle="modal" data-bs-target="#updateTaskModal" title="Edit todo" onclick="fillUpdateTaskForm(@todolist.ItemID, '@todolist.Title', '@todolist.Description', @todolist.Priority.PriorityID)">
                                                    <i class="fas fa-pencil-alt fa-lg text-white me-3"></i>
                                                </button>
                                            </div>
                                            <div class="text-center mb-2">
                                                <form method="post" action="/ToDo/SoftDelete/@todolist.ItemID">
                                                    <button type="submit" class="btn btn-bold btn-outline-warning" data-mdb-toggle="tooltip" title="Remove">
                                                        <i class="fas fa-trash-alt fa-lg text-white me-3"></i>
                                                    </button>
                                                </form>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr class="border-0 align-middle @if(todolist.IsDone) { <text>gradient-complete text-white</text> }" style="padding-left: 20px;">
                                        <td colspan="4" class="border-0 align-middle" style="padding-left: 20px;">
                                            <h6>Description</h6>
                                            <p>
                                                @todolist.Description
                                            </p>
                                        </td>
                                    </tr>
                                    <tr class="border-0 @if(todolist.IsDone) { <text>gradient-complete text-white</text> }">
                                        <td colspan="5" class="border-0" style="padding-left: 20px;">
                                            <h5 class="mb-0 d-flex justify-content-end align-items-center">
                                                <span class="badge
                                                                   @if(todolist.IsDone==false) { <text>bg-warning</text> }
                                                                   @if(todolist.IsDone==true) { <text>bg-success</text> }">
                                                    @if(todolist.IsDone==true)
                                                    {
                                                        <p>Completed</p>
                                                    }
                                                    else
                                                    {
                                                        <p>In Progress</p>
                                                    }
                                                </span>
                                            </h5>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan="5" class="border-0" style="padding-left: 2px;">
                                            <hr class="custom-divider">
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                        <div class="d-flex text-right justify-content-end">
                            <button type="button" class="btn-lg btn-primary" data-bs-toggle="modal" data-bs-target="#addTaskModal">Add Task</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Add Task Modal -->
<div class="modal fade" id="addTaskModal" tabindex="-1" aria-labelledby="addTaskModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addTaskModalLabel">Add Task</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form method="post" action="/ToDo/Create">
                    <div class="mb-3">
                        <label for="taskTitle" class="form-label">Task Title</label>
                        <input type="text" class="form-control" id="taskTitle" name="title">
                    </div>
                    <div class="mb-3">
                        <label for="taskDescription" class="form-label">Task Description</label>
                        <input type="text" class="form-control" id="taskDescription" name="description">
                    </div>
                    <div class="mb-3">
                        <label for="taskPriority" class="form-label">Priority</label>
                        <select class="form-select" id="taskPriority" name="priority">
                            <option selected>Select Priority</option>
                            @foreach (var priority in Model.Priorities)
                            {
                                <option value="@priority.PriorityID">@priority.Name</option>
                            }
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary">Add</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Update Task Modal -->
<div class="modal fade" id="updateTaskModal" tabindex="-1" aria-labelledby="updateTaskModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="updateTaskModalLabel">Update Task</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="updateTaskForm" method="post" action="/ToDo/Update">
                    <input type="hidden" id="taskId" name="id" value="">
                    <div class="mb-3">
                        <label for="updateTaskTitle" class="form-label">Task Title</label>
                        <input type="text" class="form-control" id="updateTaskTitle" name="title">
                    </div>
                    <div class="mb-3">
                        <label for="updateTaskDescription" class="form-label">Task Description</label>
                        <input type="text" class="form-control" id="updateTaskDescription" name="description">
                    </div>
                    <div class="mb-3">
                        <label for="updateTaskPriority" class="form-label">Priority</label>
                        <select class="form-select" id="updateTaskPriority" name="priority">
                            <option selected>Select Priority</option>
                            @foreach (var priority in Model.Priorities)
                            {
                                <option value="@priority.PriorityID">@priority.Name</option>
                            }
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="updateTaskUpdateDate" class="form-label">Update Date</label>
                        <input type="text" class="form-control" id="updateTaskUpdateDate" name="updateDate" value="@DateTime.Now" disabled>
                    </div>
                    <button type="submit" class="btn btn-primary">Update</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap Bundle with Popper.js -->
<script 
    src="https://stackpath.bootstrapcdn.com/bootstrap/5.1.3/js/bootstrap.bundle.min.js">
</script>

<script>
    function fillUpdateTaskForm(id, title, description, priority) {
        document.getElementById('taskId').value = id;
        document.getElementById('updateTaskTitle').value = title;
        document.getElementById('updateTaskDescription').value = description;
        document.getElementById('updateTaskPriority').value = priority;
    }
</script>